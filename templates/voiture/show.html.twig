{% extends 'base.html.twig' %}

{% block title %}{{ voiture.marque }} {{ voiture.modele }}{% endblock %}

{% block body %}
<div class="container d-flex justify-content-center mt-5">
    <div class="card shadow-lg" style="max-width: 650px; width: 100%;">

        {# IMAGE HEADER #}
        {% if voiture.image %}
            <img src="{{ asset('uploads/cars/' ~ voiture.image) }}" 
                 alt="Photo de {{ voiture.marque }} {{ voiture.modele }}" 
                 class="card-img-top"
                 style="max-height: 350px; object-fit: cover;">
        {% else %}
            <div class="bg-secondary text-white text-center p-5">
                <span style="font-size: 2rem;">üì∑</span>
                <p>Pas d'image disponible</p>
            </div>
        {% endif %}

        <div class="card-body text-center">
            <h2 class="card-title fw-bold">
                {{ voiture.marque }} {{ voiture.modele }}
            </h2>
            <h6 class="text-muted">Ann√©e : {{ voiture.annee }}</h6>

            <table class="table mt-4">
                <tr>
                    <th>ID</th>
                    <td>{{ voiture.id }}</td>
                </tr>
                <tr>
                    <th>Marque</th>
                    <td>{{ voiture.marque }}</td>
                </tr>
                <tr>
                    <th>Mod√®le</th>
                    <td>{{ voiture.modele }}</td>
                </tr>
                <tr>
                    <th>Ann√©e</th>
                    <td>{{ voiture.annee }}</td>
                </tr>
            </table>

            {# Determine if the current voiture belongs to the logged-in user #}
{% set isMine = app.user and voiture.collectionVoitures == app.user.collectionVoitures %}

<div class="text-center mt-4">

    {% if isMine %}
        <a href="{{ path('collection_voitures_list') }}" class="btn btn-outline-secondary">
            ‚Üê Retour √† ma collection
        </a>
    {% else %}
        {# Find gallery that contains this voiture (public galleries only) #}
        {% set gallery = null %}
        {% for g in voiture.galeries %}
            {% if g.publiee %}
                {% set gallery = g %}
            {% endif %}
        {% endfor %}

        {% if gallery %}
            <a href="{{ path('app_galerie_show', {id: gallery.id}) }}"
               class="btn btn-outline-secondary">
                ‚Üê Retour √† la galerie
            </a>
        {% else %}
            <a href="{{ path('app_galerie_public') }}" class="btn btn-outline-secondary">
                ‚Üê Retour
            </a>
        {% endif %}
    {% endif %}

</div>
            
        </div>
    </div>
</div>
{% endblock %}
